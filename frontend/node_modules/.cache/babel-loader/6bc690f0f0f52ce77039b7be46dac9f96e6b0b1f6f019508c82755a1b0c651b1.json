{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { eventTypes, dayIndexToDayString, authTypes } from \"@/constants\";\nimport { post, put, timeNumToTimeString, dateToTimeNum, getISODateString, isPhone, signInGoogle, getDateWithTimezone, getTimeOptions, addEventToCreatedList } from \"@/utils\";\nimport { mapActions, mapState } from \"vuex\";\nimport TimezoneSelector from \"./schedule_overlap/TimezoneSelector.vue\";\nimport HelpDialog from \"./HelpDialog.vue\";\nimport EmailInput from \"./event/EmailInput.vue\";\nimport DatePicker from \"@/components/DatePicker.vue\";\nimport SlideToggle from \"./SlideToggle.vue\";\nimport AlertText from \"@/components/AlertText.vue\";\nimport OverflowGradient from \"@/components/OverflowGradient.vue\";\nimport { guestUserId } from \"@/constants\";\nimport moment from \"moment\";\nimport dayjs from \"dayjs\";\nimport utcPlugin from \"dayjs/plugin/utc\";\nimport timezonePlugin from \"dayjs/plugin/timezone\";\nimport ExpandableSection from \"./ExpandableSection.vue\";\ndayjs.extend(utcPlugin);\ndayjs.extend(timezonePlugin);\nexport default {\n  name: \"NewEvent\",\n  emits: [\"input\"],\n  props: {\n    event: {\n      type: Object\n    },\n    edit: {\n      type: Boolean,\n      default: false\n    },\n    dialog: {\n      type: Boolean,\n      default: true\n    },\n    contactsPayload: {\n      type: Object,\n      default: () => ({})\n    },\n    showHelp: {\n      type: Boolean,\n      default: false\n    },\n    folderId: {\n      type: String,\n      default: null\n    }\n  },\n  components: {\n    TimezoneSelector,\n    HelpDialog,\n    EmailInput,\n    DatePicker,\n    SlideToggle,\n    ExpandableSection,\n    AlertText,\n    OverflowGradient\n  },\n  data: () => ({\n    formValid: true,\n    name: \"\",\n    startTime: 9,\n    endTime: 17,\n    // Deleted specificTimesEnabled (feature removed, only one time range is supported)\n    loading: false,\n    selectedDays: [],\n    // Deleted selectedDaysOfWeek, startOnMonday (feature removed, only 'Dates and times' is supported)\n    notificationsEnabled: true,\n    // Deleted daysOnly, daysOnlyOptions, dateOptions, selectedDateOption (feature removed, only 'Dates and times' is supported)\n\n    // Email reminders\n    showEmailReminders: false,\n    emails: [],\n    // For email reminders\n\n    // Advanced options\n    timezone: {},\n    helpDialog: false,\n    // Unsaved changes\n    initialEventData: {},\n    hasMounted: false\n  }),\n  mounted() {\n    if (Object.keys(this.contactsPayload).length > 0) {\n      this.toggleEmailReminders(true);\n\n      /** Get previously filled out data after enabling contacts  */\n      this.name = this.contactsPayload.name;\n      this.startTime = this.contactsPayload.startTime;\n      this.endTime = this.contactsPayload.endTime;\n      // Deleted daysOnly, selectedDateOption, selectedDaysOfWeek (feature removed)\n      this.selectedDays = this.contactsPayload.selectedDays;\n      this.notificationsEnabled = this.contactsPayload.notificationsEnabled;\n      this.timezone = this.contactsPayload.timezone;\n      // Deleted specificTimesEnabled (feature removed)\n\n      this.$refs.form.resetValidation();\n    }\n    this.$nextTick(() => {\n      this.hasMounted = true;\n    });\n  },\n  computed: {\n    ...mapState([\"authUser\"]),\n    // Deleted daysOnlyEnabled (feature removed)\n    nameRules() {\n      return [v => !!v || \"事件名称是必需填写的噢\"];\n    },\n    selectedDaysRules() {\n      return [selectedDays => selectedDays.length > 0 || \"请至少选择一个日期\"];\n    },\n    addedEmails() {\n      if (Object.keys(this.contactsPayload).length > 0) return this.contactsPayload.emails;\n      return this.event && this.event.remindees ? this.event.remindees.map(r => r.email) : [];\n    },\n    times() {\n      return getTimeOptions();\n    },\n    minCalendarDate() {\n      if (this.edit) {\n        return \"\";\n      }\n      let today = new Date();\n      let dd = String(today.getDate()).padStart(2, \"0\");\n      let mm = String(today.getMonth() + 1).padStart(2, \"0\");\n      let yyyy = today.getFullYear();\n      return yyyy + \"-\" + mm + \"-\" + dd;\n    },\n    isPhone() {\n      return isPhone(this.$vuetify);\n    },\n    guestEvent() {\n      return this.event && this.event.ownerId == guestUserId;\n    }\n  },\n  methods: {\n    ...mapActions([\"showError\", \"setEventFolder\"]),\n    blurNameField() {\n      this.$refs[\"name-field\"].blur();\n    },\n    reset() {\n      this.name = \"\";\n      this.startTime = 9;\n      this.endTime = 17;\n      this.selectedDays = [];\n      this.notificationsEnabled = true;\n      this.emails = [];\n      this.$refs.form.resetValidation();\n    },\n    submit() {\n      if (!this.$refs.form.validate()) return;\n      this.selectedDays.sort();\n\n      // Get duration of event\n      let duration = this.endTime - this.startTime;\n      if (duration <= 0) duration += 24;\n\n      // Get date objects for each selected day\n      let dates = [];\n      let type = eventTypes.SPECIFIC_DATES;\n      const startTimeString = timeNumToTimeString(this.startTime);\n      for (const day of this.selectedDays) {\n        const date = dayjs.tz(`${day} ${startTimeString}`, this.timezone.value);\n        dates.push(date.toDate());\n      }\n      this.loading = true;\n      const payload = {\n        name: this.name,\n        duration: duration,\n        dates: dates,\n        notificationsEnabled: !this.authUser ? false : this.notificationsEnabled,\n        timezone: this.timezone.value\n      };\n      const posthogPayload = {\n        eventName: this.name,\n        eventDuration: duration,\n        eventDates: JSON.stringify(dates),\n        eventNotificationsEnabled: !this.authUser ? false : this.notificationsEnabled,\n        eventType: type,\n        timezone: this.timezone.value\n      };\n      if (!this.edit) {\n        // Create new event on backend\n        post(\"/events\", payload).then(async ({\n          eventId,\n          shortId\n        }) => {\n          await this.setEventFolder({\n            eventId,\n            folderId: this.folderId\n          });\n          this.$router.push({\n            name: \"event\",\n            params: {\n              eventId: shortId ?? eventId,\n              initialTimezone: this.timezone\n            }\n          });\n          this.$emit(\"input\", false);\n          this.reset();\n          posthogPayload.eventId = eventId;\n          this.$posthog?.capture(\"Event created\", posthogPayload);\n          if (!this.authUser) {\n            // Add eventId to localStorage, so the user can claim it later\n            addEventToCreatedList(eventId);\n          }\n        }).catch(err => {\n          this.showError(\"There was a problem creating that event! Please try again later.\");\n          console.error(err);\n        }).finally(() => {\n          this.loading = false;\n        });\n      } else {\n        // Edit event on backend\n        if (this.event) {\n          put(`/events/${this.event._id}`, payload).then(() => {\n            posthogPayload.eventId = this.event._id;\n            this.$posthog?.capture(\"Event edited\", posthogPayload);\n\n            // this.$emit(\"input\", false)\n            // this.reset()\n            localStorage.setItem(`from-edit-event-${this.event._id}`, \"true\");\n            window.location.reload();\n          }).catch(err => {\n            this.showError(\"There was a problem editing this event! Please try again later.\");\n            console.log(err);\n          }).finally(() => {\n            this.loading = false;\n          });\n        }\n      }\n    },\n    toggleEmailReminders(delayed = false) {\n      if (delayed) {\n        setTimeout(() => this.showEmailReminders = !this.showEmailReminders, 300);\n      } else {\n        this.showEmailReminders = !this.showEmailReminders;\n      }\n    },\n    /** Redirects user to oauth page requesting access to the user's contacts */\n    requestContactsAccess({\n      emails\n    }) {\n      const payload = {\n        emails,\n        name: this.name,\n        startTime: this.startTime,\n        endTime: this.endTime,\n        selectedDays: this.selectedDays,\n        notificationsEnabled: this.notificationsEnabled,\n        timezone: this.timezone\n      };\n      signInGoogle({\n        state: {\n          type: authTypes.EVENT_CONTACTS,\n          eventId: this.event ? this.event.shortId ?? this.event._id : \"\",\n          openNewGroup: false,\n          payload\n        },\n        requestContactsPermission: true\n      });\n    },\n    /** Update state based on the contactsPayload after granting contacts access */\n    contactsAccessGranted({\n      curScheduledEvent,\n      ...data\n    }) {\n      this.curScheduledEvent = curScheduledEvent;\n      this.$refs.confirmDetailsDialog?.setData(data);\n      this.confirmDetailsDialog = true;\n    },\n    /** Populates the form fields based on this.event */\n    updateFieldsFromEvent() {\n      if (this.event) {\n        this.name = this.event.name;\n\n        // Set start time, accounting for the timezone\n        this.startTime = Math.floor(dateToTimeNum(getDateWithTimezone(this.event.dates[0]), true));\n        this.startTime %= 24;\n        this.endTime = (this.startTime + this.event.duration) % 24;\n        this.notificationsEnabled = this.event.notificationsEnabled;\n        if (this.event.dates && this.event.dates.length > 0) {\n          // Only support SPECIFIC_DATES\n          this.selectedDays = this.event.dates.map(date => getISODateString(getDateWithTimezone(date)));\n        }\n      }\n    },\n    resetToEventData() {\n      this.updateFieldsFromEvent();\n      this.$refs.emailInput.reset();\n    },\n    setInitialEventData() {\n      this.initialEventData = {\n        name: this.name,\n        startTime: this.startTime,\n        endTime: this.endTime,\n        selectedDays: this.selectedDays,\n        notificationsEnabled: this.notificationsEnabled,\n        emails: [...this.emails]\n      };\n    },\n    hasEventBeenEdited() {\n      return this.name !== this.initialEventData.name || this.startTime !== this.initialEventData.startTime || this.endTime !== this.initialEventData.endTime || JSON.stringify(this.selectedDays) !== JSON.stringify(this.initialEventData.selectedDays) || this.notificationsEnabled !== this.initialEventData.notificationsEnabled || JSON.stringify(this.emails) !== JSON.stringify(this.initialEventData.emails) || this.blindAvailabilityEnabled !== this.initialEventData.blindAvailabilityEnabled || this.sendEmailAfterXResponsesEnabled !== this.initialEventData.sendEmailAfterXResponsesEnabled || this.sendEmailAfterXResponses !== this.initialEventData.sendEmailAfterXResponses;\n    },\n    trackTimezoneChange(newTimezone) {\n      this.$posthog?.capture(\"timezone_selected_in_new_event_dialog\", {\n        timezone: newTimezone?.value\n      });\n    }\n  },\n  watch: {\n    event: {\n      immediate: true,\n      handler() {\n        this.updateFieldsFromEvent();\n        this.setInitialEventData();\n      }\n    }\n  }\n};","map":{"version":3,"names":["eventTypes","dayIndexToDayString","authTypes","post","put","timeNumToTimeString","dateToTimeNum","getISODateString","isPhone","signInGoogle","getDateWithTimezone","getTimeOptions","addEventToCreatedList","mapActions","mapState","TimezoneSelector","HelpDialog","EmailInput","DatePicker","SlideToggle","AlertText","OverflowGradient","guestUserId","moment","dayjs","utcPlugin","timezonePlugin","ExpandableSection","extend","name","emits","props","event","type","Object","edit","Boolean","default","dialog","contactsPayload","showHelp","folderId","String","components","data","formValid","startTime","endTime","loading","selectedDays","notificationsEnabled","showEmailReminders","emails","timezone","helpDialog","initialEventData","hasMounted","mounted","keys","length","toggleEmailReminders","$refs","form","resetValidation","$nextTick","computed","nameRules","v","selectedDaysRules","addedEmails","remindees","map","r","email","times","minCalendarDate","today","Date","dd","getDate","padStart","mm","getMonth","yyyy","getFullYear","$vuetify","guestEvent","ownerId","methods","blurNameField","blur","reset","submit","validate","sort","duration","dates","SPECIFIC_DATES","startTimeString","day","date","tz","value","push","toDate","payload","authUser","posthogPayload","eventName","eventDuration","eventDates","JSON","stringify","eventNotificationsEnabled","eventType","then","eventId","shortId","setEventFolder","$router","params","initialTimezone","$emit","$posthog","capture","catch","err","showError","console","error","finally","_id","localStorage","setItem","window","location","reload","log","delayed","setTimeout","requestContactsAccess","state","EVENT_CONTACTS","openNewGroup","requestContactsPermission","contactsAccessGranted","curScheduledEvent","confirmDetailsDialog","setData","updateFieldsFromEvent","Math","floor","resetToEventData","emailInput","setInitialEventData","hasEventBeenEdited","blindAvailabilityEnabled","sendEmailAfterXResponsesEnabled","sendEmailAfterXResponses","trackTimezoneChange","newTimezone","watch","immediate","handler"],"sources":["src/components/NewEvent.vue"],"sourcesContent":["<template>\n  <v-card\n    :flat=\"dialog\"\n    :class=\"{ 'tw-py-4': !dialog, 'tw-flex-1': dialog }\"\n    class=\"tw-relative tw-flex tw-max-w-[28rem] tw-flex-col tw-overflow-hidden tw-rounded-lg tw-transition-all\"\n  >\n    <v-card-title class=\"tw-mb-2 tw-flex tw-gap-2 tw-px-4 sm:tw-px-8\">\n      <div>\n        <div class=\"tw-mb-1\">\n          {{ edit ? \"Edit event\" : \"创建事件\" }}\n        </div>\n        <div\n          v-if=\"dialog && showHelp\"\n          class=\"tw-text-xs tw-font-normal tw-italic tw-text-dark-gray\"\n        >\n          Ideal for one-time / recurring meetings\n        </div>\n      </div>\n      <v-spacer />\n      <template v-if=\"dialog\">\n        <v-btn v-if=\"showHelp\" icon @click=\"helpDialog = true\">\n          <v-icon>mdi-information-outline</v-icon>\n        </v-btn>\n        <v-btn v-else @click=\"$emit('input', false)\" icon>\n          <v-icon>mdi-close</v-icon>\n        </v-btn>\n        <HelpDialog v-model=\"helpDialog\">\n          <template v-slot:header>Events</template>\n          <div class=\"tw-mb-4\">\n            Use events to collect people's availabilities and compare them\n            across certain days.\n          </div>\n        </HelpDialog>\n      </template>\n    </v-card-title>\n    <v-card-text\n      ref=\"cardText\"\n      class=\"tw-relative tw-flex-1 tw-overflow-auto tw-px-4 tw-py-1 sm:tw-px-8\"\n    >\n      <AlertText v-if=\"edit && event?.ownerId == 0\" class=\"tw-mb-4\">\n        Anybody can edit this event because it was created while not signed in\n      </AlertText>\n      <v-form\n        ref=\"form\"\n        v-model=\"formValid\"\n        lazy-validation\n        class=\"tw-flex tw-flex-col tw-gap-y-6\"\n        :disabled=\"loading\"\n      >\n        <v-text-field\n          ref=\"name-field\"\n          v-model=\"name\"\n          placeholder=\"事件名称...\"\n          hide-details=\"auto\"\n          solo\n          @keyup.enter=\"blurNameField\"\n          :rules=\"nameRules\"\n          autofocus\n          required\n        />\n\n        <!-- Deleted SlideToggle for 'Date Only'/'Dates and times' selection (feature removed) -->\n\n        <div>\n          <v-expand-transition>\n            <div v-if=\"!daysOnly\">\n              <div class=\"tw-mb-2 tw-text-lg tw-text-black\">\n                会议可能的时间\n              </div>\n              <v-expand-transition>\n                <div v-if=\"!specificTimesEnabled\">\n                  <div\n                    class=\"tw-mb-2 tw-flex tw-items-baseline tw-justify-center tw-space-x-2\"\n                  >\n                    <v-select\n                      :value=\"startTime\"\n                      @input=\"(t) => (startTime = t.time)\"\n                      menu-props=\"auto\"\n                      :items=\"times\"\n                      return-object\n                      hide-details\n                      solo\n                    ></v-select>\n                    <div>to</div>\n                    <v-select\n                      :value=\"endTime\"\n                      @input=\"(t) => (endTime = t.time)\"\n                      menu-props=\"auto\"\n                      :items=\"times\"\n                      return-object\n                      hide-details\n                      solo\n                    ></v-select>\n                  </div>\n                </div>\n              </v-expand-transition>\n              <div class=\"tw-mb-2\">\n                <!-- Deleted v-checkbox and all UI for 'Set specific times per day' (feature removed) -->\n              </div>\n            </div>\n          </v-expand-transition>\n\n          <div class=\"tw-mb-2 tw-text-lg tw-text-black\">\n            请选择日期\n          </div>\n          <!-- Deleted v-select for dateOptions (feature removed, only 'Dates and times' is allowed) -->\n\n          <v-expand-transition>\n            <div>\n              <div class=\"tw-mb-2 tw-text-xs tw-text-dark-gray\">\n                Drag to select multiple dates\n              </div>\n              <v-input\n                v-model=\"selectedDays\"\n                hide-details=\"auto\"\n                :rules=\"selectedDaysRules\"\n                key=\"date-picker\"\n              >\n                <DatePicker\n                  v-model=\"selectedDays\"\n                  :minCalendarDate=\"minCalendarDate\"\n                />\n              </v-input>\n            </div>\n            <!-- Deleted 'Days of the week' selection (feature removed, only specific dates allowed) -->\n          </v-expand-transition>\n        </div>\n\n        <!-- Deleted all UI for 'Email me each time someone joins my event' notification feature (feature removed) -->\n\n        <div class=\"tw-flex tw-flex-col tw-gap-2\">\n          <ExpandableSection\n            v-if=\"authUser && !guestEvent\"\n            label=\"Email reminders\"\n            v-model=\"showEmailReminders\"\n            :auto-scroll=\"dialog\"\n          >\n            <div class=\"tw-flex tw-flex-col tw-gap-5 tw-pt-2\">\n              <EmailInput\n                v-show=\"authUser\"\n                ref=\"emailInput\"\n                @requestContactsAccess=\"requestContactsAccess\"\n                labelColor=\"tw-text-very-dark-gray\"\n                :addedEmails=\"addedEmails\"\n                @update:emails=\"(newEmails) => (emails = newEmails)\"\n              >\n                <template v-slot:header>\n                  <div class=\"tw-flex tw-gap-1\">\n                    <div class=\"tw-text-very-dark-gray\">\n                      Remind people to fill out the event\n                    </div>\n\n                    <v-tooltip\n                      top\n                      content-class=\"tw-bg-very-dark-gray tw-shadow-lg tw-opacity-100 tw-py-4\"\n                    >\n                      <template v-slot:activator=\"{ on, attrs }\">\n                        <v-icon small v-bind=\"attrs\" v-on=\"on\"\n                          >mdi-information-outline\n                        </v-icon>\n                      </template>\n                      <div>\n                        Reminder emails will be sent the day of event\n                        creation,<br />one day after, and three days after. You\n                        will also receive <br />an email when everybody has\n                        filled out the event.\n                      </div>\n                    </v-tooltip>\n                  </div>\n                </template>\n              </EmailInput>\n            </div>\n          </ExpandableSection>\n\n          <!-- Deleted all advanced options except Timezone. -->\n          <!-- TimezoneSelector has been moved outside this container. -->\n        </div>\n      </v-form>\n    </v-card-text>\n    <v-card-actions class=\"tw-relative tw-px-4 sm:tw-px-8\">\n      <div class=\"tw-relative tw-w-full\">\n        <v-btn\n          :disabled=\"!formValid\"\n          block\n          :loading=\"loading\"\n          color=\"primary\"\n          class=\"tw-mt-4 tw-bg-green\"\n          @click=\"submit\"\n        >\n          {{\n            specificTimesEnabled ? \"Next\" : edit ? \"Save edits\" : \"Create event\"\n          }}\n        </v-btn>\n        <div\n          :class=\"formValid ? 'tw-invisible' : 'tw-visible'\"\n          class=\"tw-mt-1 tw-text-xs tw-text-red\"\n        >\n          Please fix form errors before continuing\n        </div>\n      </div>\n    </v-card-actions>\n\n    <OverflowGradient\n      v-if=\"hasMounted\"\n      :scrollContainer=\"$refs.cardText\"\n      class=\"tw-bottom-[90px]\"\n    />\n  </v-card>\n</template>\n\n<style>\n.email-me-after-text-field input {\n  padding: 0px !important;\n}\n</style>\n\n<script>\nimport { eventTypes, dayIndexToDayString, authTypes } from \"@/constants\"\nimport {\n  post,\n  put,\n  timeNumToTimeString,\n  dateToTimeNum,\n  getISODateString,\n  isPhone,\n  signInGoogle,\n  getDateWithTimezone,\n  getTimeOptions,\n  addEventToCreatedList,\n} from \"@/utils\"\nimport { mapActions, mapState } from \"vuex\"\nimport TimezoneSelector from \"./schedule_overlap/TimezoneSelector.vue\"\nimport HelpDialog from \"./HelpDialog.vue\"\nimport EmailInput from \"./event/EmailInput.vue\"\nimport DatePicker from \"@/components/DatePicker.vue\"\nimport SlideToggle from \"./SlideToggle.vue\"\nimport AlertText from \"@/components/AlertText.vue\"\nimport OverflowGradient from \"@/components/OverflowGradient.vue\"\nimport { guestUserId } from \"@/constants\"\nimport moment from \"moment\"\n\nimport dayjs from \"dayjs\"\nimport utcPlugin from \"dayjs/plugin/utc\"\nimport timezonePlugin from \"dayjs/plugin/timezone\"\nimport ExpandableSection from \"./ExpandableSection.vue\"\ndayjs.extend(utcPlugin)\ndayjs.extend(timezonePlugin)\n\nexport default {\n  name: \"NewEvent\",\n\n  emits: [\"input\"],\n\n  props: {\n    event: { type: Object },\n    edit: { type: Boolean, default: false },\n    dialog: { type: Boolean, default: true },\n    contactsPayload: { type: Object, default: () => ({}) },\n    showHelp: { type: Boolean, default: false },\n    folderId: { type: String, default: null },\n  },\n\n  components: {\n    TimezoneSelector,\n    HelpDialog,\n    EmailInput,\n    DatePicker,\n    SlideToggle,\n    ExpandableSection,\n    AlertText,\n    OverflowGradient,\n  },\n\n  data: () => ({\n    formValid: true,\n    name: \"\",\n    startTime: 9,\n    endTime: 17,\n    // Deleted specificTimesEnabled (feature removed, only one time range is supported)\n    loading: false,\n    selectedDays: [],\n    // Deleted selectedDaysOfWeek, startOnMonday (feature removed, only 'Dates and times' is supported)\n    notificationsEnabled: true,\n\n    // Deleted daysOnly, daysOnlyOptions, dateOptions, selectedDateOption (feature removed, only 'Dates and times' is supported)\n\n    // Email reminders\n    showEmailReminders: false,\n    emails: [], // For email reminders\n\n    // Advanced options\n    timezone: {},\n\n    helpDialog: false,\n\n    // Unsaved changes\n    initialEventData: {},\n\n    hasMounted: false,\n  }),\n\n  mounted() {\n    if (Object.keys(this.contactsPayload).length > 0) {\n      this.toggleEmailReminders(true)\n\n      /** Get previously filled out data after enabling contacts  */\n      this.name = this.contactsPayload.name\n      this.startTime = this.contactsPayload.startTime\n      this.endTime = this.contactsPayload.endTime\n      // Deleted daysOnly, selectedDateOption, selectedDaysOfWeek (feature removed)\n      this.selectedDays = this.contactsPayload.selectedDays\n      this.notificationsEnabled = this.contactsPayload.notificationsEnabled\n      this.timezone = this.contactsPayload.timezone\n      // Deleted specificTimesEnabled (feature removed)\n\n      this.$refs.form.resetValidation()\n    }\n\n    this.$nextTick(() => {\n      this.hasMounted = true\n    })\n  },\n\n  computed: {\n    ...mapState([\"authUser\"]), // Deleted daysOnlyEnabled (feature removed)\n    nameRules() {\n      return [(v) => !!v || \"事件名称是必需填写的噢\"]\n    },\n    selectedDaysRules() {\n      return [\n        (selectedDays) =>\n          selectedDays.length > 0 || \"请至少选择一个日期\",\n      ]\n    },\n    addedEmails() {\n      if (Object.keys(this.contactsPayload).length > 0)\n        return this.contactsPayload.emails\n      return this.event && this.event.remindees\n        ? this.event.remindees.map((r) => r.email)\n        : []\n    },\n    times() {\n      return getTimeOptions()\n    },\n    minCalendarDate() {\n      if (this.edit) {\n        return \"\"\n      }\n\n      let today = new Date()\n      let dd = String(today.getDate()).padStart(2, \"0\")\n      let mm = String(today.getMonth() + 1).padStart(2, \"0\")\n      let yyyy = today.getFullYear()\n\n      return yyyy + \"-\" + mm + \"-\" + dd\n    },\n    isPhone() {\n      return isPhone(this.$vuetify)\n    },\n    guestEvent() {\n      return this.event && this.event.ownerId == guestUserId\n    },\n  },\n\n  methods: {\n    ...mapActions([\"showError\", \"setEventFolder\"]),\n    blurNameField() {\n      this.$refs[\"name-field\"].blur()\n    },\n    reset() {\n      this.name = \"\"\n      this.startTime = 9\n      this.endTime = 17\n      this.selectedDays = []\n      this.notificationsEnabled = true\n      this.emails = []\n\n      this.$refs.form.resetValidation()\n    },\n    submit() {\n      if (!this.$refs.form.validate()) return\n\n      this.selectedDays.sort()\n\n      // Get duration of event\n      let duration = this.endTime - this.startTime\n      if (duration <= 0) duration += 24\n\n      // Get date objects for each selected day\n      let dates = []\n      let type = eventTypes.SPECIFIC_DATES\n      const startTimeString = timeNumToTimeString(this.startTime)\n      for (const day of this.selectedDays) {\n        const date = dayjs.tz(\n          `${day} ${startTimeString}`,\n          this.timezone.value\n        )\n        dates.push(date.toDate())\n      }\n\n      this.loading = true\n\n      const payload = {\n        name: this.name,\n        duration: duration,\n        dates: dates,\n        notificationsEnabled: !this.authUser\n          ? false\n          : this.notificationsEnabled,\n        timezone: this.timezone.value,\n      }\n\n      const posthogPayload = {\n        eventName: this.name,\n        eventDuration: duration,\n        eventDates: JSON.stringify(dates),\n        eventNotificationsEnabled: !this.authUser\n          ? false\n          : this.notificationsEnabled,\n        eventType: type,\n        timezone: this.timezone.value,\n      }\n\n      if (!this.edit) {\n        // Create new event on backend\n        post(\"/events\", payload)\n          .then(async ({ eventId, shortId }) => {\n            await this.setEventFolder({ eventId, folderId: this.folderId })\n            this.$router.push({\n              name: \"event\",\n              params: {\n                eventId: shortId ?? eventId,\n                initialTimezone: this.timezone,\n              },\n            })\n\n            this.$emit(\"input\", false)\n            this.reset()\n\n            posthogPayload.eventId = eventId\n            this.$posthog?.capture(\"Event created\", posthogPayload)\n\n            if (!this.authUser) {\n              // Add eventId to localStorage, so the user can claim it later\n              addEventToCreatedList(eventId)\n            }\n          })\n          .catch((err) => {\n            this.showError(\n              \"There was a problem creating that event! Please try again later.\"\n            )\n            console.error(err)\n          })\n          .finally(() => {\n            this.loading = false\n          })\n      } else {\n        // Edit event on backend\n        if (this.event) {\n          put(`/events/${this.event._id}`, payload)\n            .then(() => {\n              posthogPayload.eventId = this.event._id\n              this.$posthog?.capture(\"Event edited\", posthogPayload)\n\n              // this.$emit(\"input\", false)\n              // this.reset()\n              localStorage.setItem(`from-edit-event-${this.event._id}`, \"true\")\n              window.location.reload()\n            })\n            .catch((err) => {\n              this.showError(\n                \"There was a problem editing this event! Please try again later.\"\n              )\n              console.log(err)\n            })\n            .finally(() => {\n              this.loading = false\n            })\n        }\n      }\n    },\n\n    toggleEmailReminders(delayed = false) {\n      if (delayed) {\n        setTimeout(\n          () => (this.showEmailReminders = !this.showEmailReminders),\n          300\n        )\n      } else {\n        this.showEmailReminders = !this.showEmailReminders\n      }\n    },\n\n    /** Redirects user to oauth page requesting access to the user's contacts */\n    requestContactsAccess({ emails }) {\n      const payload = {\n        emails,\n        name: this.name,\n        startTime: this.startTime,\n        endTime: this.endTime,\n        selectedDays: this.selectedDays,\n        notificationsEnabled: this.notificationsEnabled,\n        timezone: this.timezone,\n      }\n      signInGoogle({\n        state: {\n          type: authTypes.EVENT_CONTACTS,\n          eventId: this.event ? this.event.shortId ?? this.event._id : \"\",\n          openNewGroup: false,\n          payload,\n        },\n        requestContactsPermission: true,\n      })\n    },\n    /** Update state based on the contactsPayload after granting contacts access */\n    contactsAccessGranted({ curScheduledEvent, ...data }) {\n      this.curScheduledEvent = curScheduledEvent\n      this.$refs.confirmDetailsDialog?.setData(data)\n      this.confirmDetailsDialog = true\n    },\n\n    /** Populates the form fields based on this.event */\n    updateFieldsFromEvent() {\n      if (this.event) {\n        this.name = this.event.name\n\n        // Set start time, accounting for the timezone\n        this.startTime = Math.floor(\n          dateToTimeNum(getDateWithTimezone(this.event.dates[0]), true)\n        )\n        this.startTime %= 24\n\n        this.endTime = (this.startTime + this.event.duration) % 24\n        this.notificationsEnabled = this.event.notificationsEnabled\n\n        if (this.event.dates && this.event.dates.length > 0) {\n          // Only support SPECIFIC_DATES\n          this.selectedDays = this.event.dates.map((date) =>\n            getISODateString(getDateWithTimezone(date))\n          )\n        }\n      }\n    },\n    resetToEventData() {\n      this.updateFieldsFromEvent()\n      this.$refs.emailInput.reset()\n    },\n    setInitialEventData() {\n      this.initialEventData = {\n        name: this.name,\n        startTime: this.startTime,\n        endTime: this.endTime,\n        selectedDays: this.selectedDays,\n        notificationsEnabled: this.notificationsEnabled,\n        emails: [...this.emails],\n      }\n    },\n    hasEventBeenEdited() {\n      return (\n        this.name !== this.initialEventData.name ||\n        this.startTime !== this.initialEventData.startTime ||\n        this.endTime !== this.initialEventData.endTime ||\n        JSON.stringify(this.selectedDays) !==\n          JSON.stringify(this.initialEventData.selectedDays) ||\n        this.notificationsEnabled !==\n          this.initialEventData.notificationsEnabled ||\n        JSON.stringify(this.emails) !==\n          JSON.stringify(this.initialEventData.emails) ||\n        this.blindAvailabilityEnabled !==\n          this.initialEventData.blindAvailabilityEnabled ||\n        this.sendEmailAfterXResponsesEnabled !==\n          this.initialEventData.sendEmailAfterXResponsesEnabled ||\n        this.sendEmailAfterXResponses !==\n          this.initialEventData.sendEmailAfterXResponses\n      )\n    },\n    trackTimezoneChange(newTimezone) {\n      this.$posthog?.capture(\"timezone_selected_in_new_event_dialog\", {\n        timezone: newTimezone?.value,\n      })\n    },\n  },\n\n  watch: {\n    event: {\n      immediate: true,\n      handler() {\n        this.updateFieldsFromEvent()\n        this.setInitialEventData()\n      },\n    },\n  },\n}\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}