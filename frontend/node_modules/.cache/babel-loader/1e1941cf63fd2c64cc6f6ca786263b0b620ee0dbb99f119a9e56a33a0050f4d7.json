{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { get, post } from \"@/utils\";\nimport { mapMutations } from \"vuex\";\nimport confetti from \"canvas-confetti\";\nexport default {\n  name: \"StripeRedirect\",\n  data() {\n    return {\n      fulfillmentComplete: false,\n      redirectUrl: \"\"\n    };\n  },\n  methods: {\n    ...mapMutations([\"setAuthUser\"]),\n    // Assuming setAuthUser might be needed if fulfillment updates user state\n    async handleRedirect() {\n      const urlParams = new URLSearchParams(window.location.search);\n      const upgradeStatus = urlParams.get(\"upgrade\");\n      const sessionId = urlParams.get(\"session_id\");\n      this.redirectUrl = urlParams.get(\"redirect_url\");\n      if (!this.redirectUrl) {\n        this.$router.replace({\n          name: \"home\"\n        });\n        return;\n      }\n      try {\n        if (upgradeStatus === \"success\" && sessionId) {\n          // Fulfill checkout\n          await post(\"/stripe/fulfill-checkout\", {\n            sessionId\n          });\n          const user = await get(\"/user/profile\");\n          this.setAuthUser(user);\n          this.fulfillmentComplete = true;\n          this.fireConfetti();\n          this.$posthog.capture(\"upgrade_success\");\n        } else {\n          // Upgrade cancelled, navigate to redirect url\n          this.navigateToRedirectUrl();\n        }\n      } catch (err) {\n        // Error during checkout fulfillment, navigate to redirect url\n        console.error(\"Error during Stripe redirect handling:\", err);\n        this.navigateToRedirectUrl();\n      }\n    },\n    navigateToRedirectUrl() {\n      window.location.replace(this.redirectUrl);\n    },\n    fireConfetti() {\n      var duration = 15 * 1000;\n      var animationEnd = Date.now() + duration;\n      var defaults = {\n        startVelocity: 30,\n        spread: 360,\n        ticks: 60,\n        zIndex: 0\n      };\n      function randomInRange(min, max) {\n        return Math.random() * (max - min) + min;\n      }\n      var interval = setInterval(function () {\n        var timeLeft = animationEnd - Date.now();\n        if (timeLeft <= 0) {\n          return clearInterval(interval);\n        }\n        var particleCount = 50 * (timeLeft / duration);\n        // since particles fall down, start a bit higher than random\n        confetti({\n          ...defaults,\n          particleCount,\n          origin: {\n            x: randomInRange(0.1, 0.3),\n            y: Math.random() - 0.2\n          }\n        });\n        confetti({\n          ...defaults,\n          particleCount,\n          origin: {\n            x: randomInRange(0.7, 0.9),\n            y: Math.random() - 0.2\n          }\n        });\n      }, 250);\n    }\n  },\n  mounted() {\n    this.handleRedirect();\n  }\n};","map":{"version":3,"names":["get","post","mapMutations","confetti","name","data","fulfillmentComplete","redirectUrl","methods","handleRedirect","urlParams","URLSearchParams","window","location","search","upgradeStatus","sessionId","$router","replace","user","setAuthUser","fireConfetti","$posthog","capture","navigateToRedirectUrl","err","console","error","duration","animationEnd","Date","now","defaults","startVelocity","spread","ticks","zIndex","randomInRange","min","max","Math","random","interval","setInterval","timeLeft","clearInterval","particleCount","origin","x","y","mounted"],"sources":["src/views/StripeRedirect.vue"],"sourcesContent":["<template>\n  <div class=\"tw-flex tw-h-screen tw-items-center tw-justify-center tw-p-4\">\n    <div class=\"tw-text-center\">\n      <v-progress-circular\n        v-if=\"!fulfillmentComplete\"\n        indeterminate\n        color=\"primary\"\n        size=\"32\"\n      ></v-progress-circular>\n      <template v-else>\n        <div class=\"tw-flex tw-flex-col tw-items-center tw-gap-4\">\n          <v-img\n            alt=\"schejie heart\"\n            src=\"@/assets/schejie/heart.png\"\n            transition=\"fade-transition\"\n            contain\n            class=\"tw-mb-0 tw-h-[150px] tw-flex-none sm:tw-h-[200px]\"\n          />\n          <div class=\"tw-text-xl tw-font-medium\">\n            You've upgraded to <br class=\"tw-block sm:tw-hidden\" />\n            <span\n              class=\"tw-bg-gradient-to-r tw-from-darkest-green tw-to-light-green tw-bg-clip-text tw-text-transparent\"\n              >Schej Premium</span\n            >!\n          </div>\n          <div>\n            <v-btn color=\"primary\" @click=\"navigateToRedirectUrl\">\n              Continue\n            </v-btn>\n          </div>\n        </div>\n      </template>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { get, post } from \"@/utils\"\nimport { mapMutations } from \"vuex\"\nimport confetti from \"canvas-confetti\"\n\nexport default {\n  name: \"StripeRedirect\",\n  data() {\n    return {\n      fulfillmentComplete: false,\n      redirectUrl: \"\",\n    }\n  },\n  methods: {\n    ...mapMutations([\"setAuthUser\"]), // Assuming setAuthUser might be needed if fulfillment updates user state\n    async handleRedirect() {\n      const urlParams = new URLSearchParams(window.location.search)\n      const upgradeStatus = urlParams.get(\"upgrade\")\n      const sessionId = urlParams.get(\"session_id\")\n      this.redirectUrl = urlParams.get(\"redirect_url\")\n\n      if (!this.redirectUrl) {\n        this.$router.replace({ name: \"home\" })\n        return\n      }\n\n      try {\n        if (upgradeStatus === \"success\" && sessionId) {\n          // Fulfill checkout\n          await post(\"/stripe/fulfill-checkout\", { sessionId })\n          const user = await get(\"/user/profile\")\n          this.setAuthUser(user)\n          this.fulfillmentComplete = true\n          this.fireConfetti()\n          this.$posthog.capture(\"upgrade_success\")\n        } else {\n          // Upgrade cancelled, navigate to redirect url\n          this.navigateToRedirectUrl()\n        }\n      } catch (err) {\n        // Error during checkout fulfillment, navigate to redirect url\n        console.error(\"Error during Stripe redirect handling:\", err)\n        this.navigateToRedirectUrl()\n      }\n    },\n    navigateToRedirectUrl() {\n      window.location.replace(this.redirectUrl)\n    },\n    fireConfetti() {\n      var duration = 15 * 1000\n      var animationEnd = Date.now() + duration\n      var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 }\n\n      function randomInRange(min, max) {\n        return Math.random() * (max - min) + min\n      }\n\n      var interval = setInterval(function () {\n        var timeLeft = animationEnd - Date.now()\n\n        if (timeLeft <= 0) {\n          return clearInterval(interval)\n        }\n\n        var particleCount = 50 * (timeLeft / duration)\n        // since particles fall down, start a bit higher than random\n        confetti({\n          ...defaults,\n          particleCount,\n          origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },\n        })\n        confetti({\n          ...defaults,\n          particleCount,\n          origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },\n        })\n      }, 250)\n    },\n  },\n  mounted() {\n    this.handleRedirect()\n  },\n}\n</script>\n"],"mappings":";;;AAqCA,SAAAA,GAAA,EAAAC,IAAA;AACA,SAAAC,YAAA;AACA,OAAAC,QAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,mBAAA;MACAC,WAAA;IACA;EACA;EACAC,OAAA;IACA,GAAAN,YAAA;IAAA;IACA,MAAAO,eAAA;MACA,MAAAC,SAAA,OAAAC,eAAA,CAAAC,MAAA,CAAAC,QAAA,CAAAC,MAAA;MACA,MAAAC,aAAA,GAAAL,SAAA,CAAAV,GAAA;MACA,MAAAgB,SAAA,GAAAN,SAAA,CAAAV,GAAA;MACA,KAAAO,WAAA,GAAAG,SAAA,CAAAV,GAAA;MAEA,UAAAO,WAAA;QACA,KAAAU,OAAA,CAAAC,OAAA;UAAAd,IAAA;QAAA;QACA;MACA;MAEA;QACA,IAAAW,aAAA,kBAAAC,SAAA;UACA;UACA,MAAAf,IAAA;YAAAe;UAAA;UACA,MAAAG,IAAA,SAAAnB,GAAA;UACA,KAAAoB,WAAA,CAAAD,IAAA;UACA,KAAAb,mBAAA;UACA,KAAAe,YAAA;UACA,KAAAC,QAAA,CAAAC,OAAA;QACA;UACA;UACA,KAAAC,qBAAA;QACA;MACA,SAAAC,GAAA;QACA;QACAC,OAAA,CAAAC,KAAA,2CAAAF,GAAA;QACA,KAAAD,qBAAA;MACA;IACA;IACAA,sBAAA;MACAZ,MAAA,CAAAC,QAAA,CAAAK,OAAA,MAAAX,WAAA;IACA;IACAc,aAAA;MACA,IAAAO,QAAA;MACA,IAAAC,YAAA,GAAAC,IAAA,CAAAC,GAAA,KAAAH,QAAA;MACA,IAAAI,QAAA;QAAAC,aAAA;QAAAC,MAAA;QAAAC,KAAA;QAAAC,MAAA;MAAA;MAEA,SAAAC,cAAAC,GAAA,EAAAC,GAAA;QACA,OAAAC,IAAA,CAAAC,MAAA,MAAAF,GAAA,GAAAD,GAAA,IAAAA,GAAA;MACA;MAEA,IAAAI,QAAA,GAAAC,WAAA;QACA,IAAAC,QAAA,GAAAf,YAAA,GAAAC,IAAA,CAAAC,GAAA;QAEA,IAAAa,QAAA;UACA,OAAAC,aAAA,CAAAH,QAAA;QACA;QAEA,IAAAI,aAAA,SAAAF,QAAA,GAAAhB,QAAA;QACA;QACAzB,QAAA;UACA,GAAA6B,QAAA;UACAc,aAAA;UACAC,MAAA;YAAAC,CAAA,EAAAX,aAAA;YAAAY,CAAA,EAAAT,IAAA,CAAAC,MAAA;UAAA;QACA;QACAtC,QAAA;UACA,GAAA6B,QAAA;UACAc,aAAA;UACAC,MAAA;YAAAC,CAAA,EAAAX,aAAA;YAAAY,CAAA,EAAAT,IAAA,CAAAC,MAAA;UAAA;QACA;MACA;IACA;EACA;EACAS,QAAA;IACA,KAAAzC,cAAA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}