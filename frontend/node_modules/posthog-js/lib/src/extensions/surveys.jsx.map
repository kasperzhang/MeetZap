{"version":3,"file":"surveys.jsx","sourceRoot":"","sources":["../../../src/extensions/surveys.tsx"],"names":[],"mappings":"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","sourcesContent":["import { PostHog } from '../posthog-core'\nimport {\n    Survey,\n    SurveyAppearance,\n    SurveyCallback,\n    SurveyPosition,\n    SurveyQuestion,\n    SurveyQuestionBranchingType,\n    SurveyQuestionType,\n    SurveySchedule,\n    SurveyType,\n    SurveyWidgetType,\n} from '../posthog-surveys-types'\nimport { addEventListener } from '../utils'\n\nimport * as Preact from 'preact'\nimport { useContext, useEffect, useMemo, useState } from 'preact/hooks'\nimport { document as _document, window as _window } from '../utils/globals'\nimport {\n    doesSurveyActivateByAction,\n    doesSurveyActivateByEvent,\n    isSurveyRunning,\n    SURVEY_LOGGER as logger,\n} from '../utils/survey-utils'\nimport { isNull, isNumber } from '../utils/type-utils'\nimport { createWidgetStyle, retrieveWidgetShadow } from './surveys-widget'\nimport { ConfirmationMessage } from './surveys/components/ConfirmationMessage'\nimport { Cancel } from './surveys/components/QuestionHeader'\nimport {\n    LinkQuestion,\n    MultipleChoiceQuestion,\n    OpenTextQuestion,\n    RatingQuestion,\n} from './surveys/components/QuestionTypes'\nimport {\n    canActivateRepeatedly,\n    createShadow,\n    defaultSurveyAppearance,\n    dismissedSurveyEvent,\n    doesSurveyDeviceTypesMatch,\n    doesSurveyMatchSelector,\n    doesSurveyUrlMatch,\n    getContrastingTextColor,\n    getDisplayOrderQuestions,\n    getSurveyContainerClass,\n    getSurveyResponseKey,\n    getSurveySeen,\n    hasWaitPeriodPassed,\n    sendSurveyEvent,\n    style,\n    SURVEY_DEFAULT_Z_INDEX,\n    SurveyContext,\n} from './surveys/surveys-extension-utils'\nimport { prepareStylesheet } from './utils/stylesheet-loader'\n\n// We cast the types here which is dangerous but protected by the top level generateSurveys call\nconst window = _window as Window & typeof globalThis\nconst document = _document as Document\n\nconst DISPATCH_FEEDBACK_WIDGET_EVENT = 'ph:show_survey_widget'\n\nfunction getRatingBucketForResponseValue(responseValue: number, scale: number) {\n    if (scale === 3) {\n        if (responseValue < 1 || responseValue > 3) {\n            throw new Error('The response must be in range 1-3')\n        }\n\n        return responseValue === 1 ? 'negative' : responseValue === 2 ? 'neutral' : 'positive'\n    } else if (scale === 5) {\n        if (responseValue < 1 || responseValue > 5) {\n            throw new Error('The response must be in range 1-5')\n        }\n\n        return responseValue <= 2 ? 'negative' : responseValue === 3 ? 'neutral' : 'positive'\n    } else if (scale === 7) {\n        if (responseValue < 1 || responseValue > 7) {\n            throw new Error('The response must be in range 1-7')\n        }\n\n        return responseValue <= 3 ? 'negative' : responseValue === 4 ? 'neutral' : 'positive'\n    } else if (scale === 10) {\n        if (responseValue < 0 || responseValue > 10) {\n            throw new Error('The response must be in range 0-10')\n        }\n\n        return responseValue <= 6 ? 'detractors' : responseValue <= 8 ? 'passives' : 'promoters'\n    }\n\n    throw new Error('The scale must be one of: 3, 5, 7, 10')\n}\n\nexport function getNextSurveyStep(\n    survey: Survey,\n    currentQuestionIndex: number,\n    response: string | string[] | number | null\n) {\n    const question = survey.questions[currentQuestionIndex]\n    const nextQuestionIndex = currentQuestionIndex + 1\n\n    if (!question.branching?.type) {\n        if (currentQuestionIndex === survey.questions.length - 1) {\n            return SurveyQuestionBranchingType.End\n        }\n\n        return nextQuestionIndex\n    }\n\n    if (question.branching.type === SurveyQuestionBranchingType.End) {\n        return SurveyQuestionBranchingType.End\n    } else if (question.branching.type === SurveyQuestionBranchingType.SpecificQuestion) {\n        if (Number.isInteger(question.branching.index)) {\n            return question.branching.index\n        }\n    } else if (question.branching.type === SurveyQuestionBranchingType.ResponseBased) {\n        // Single choice\n        if (question.type === SurveyQuestionType.SingleChoice) {\n            // :KLUDGE: for now, look up the choiceIndex based on the response\n            // TODO: once QuestionTypes.MultipleChoiceQuestion is refactored, pass the selected choiceIndex into this method\n            let selectedChoiceIndex = question.choices.indexOf(`${response}`)\n\n            if (selectedChoiceIndex === -1 && question.hasOpenChoice) {\n                // if the response is not found in the choices, it must be the open choice,\n                // which is always the last choice\n                selectedChoiceIndex = question.choices.length - 1\n            }\n\n            if (question.branching?.responseValues?.hasOwnProperty(selectedChoiceIndex)) {\n                const nextStep = question.branching.responseValues[selectedChoiceIndex]\n\n                // Specific question\n                if (Number.isInteger(nextStep)) {\n                    return nextStep\n                }\n\n                if (nextStep === SurveyQuestionBranchingType.End) {\n                    return SurveyQuestionBranchingType.End\n                }\n\n                return nextQuestionIndex\n            }\n        } else if (question.type === SurveyQuestionType.Rating) {\n            if (typeof response !== 'number' || !Number.isInteger(response)) {\n                throw new Error('The response type must be an integer')\n            }\n\n            const ratingBucket = getRatingBucketForResponseValue(response, question.scale)\n\n            if (question.branching?.responseValues?.hasOwnProperty(ratingBucket)) {\n                const nextStep = question.branching.responseValues[ratingBucket]\n\n                // Specific question\n                if (Number.isInteger(nextStep)) {\n                    return nextStep\n                }\n\n                if (nextStep === SurveyQuestionBranchingType.End) {\n                    return SurveyQuestionBranchingType.End\n                }\n\n                return nextQuestionIndex\n            }\n        }\n\n        return nextQuestionIndex\n    }\n\n    logger.warn('Falling back to next question index due to unexpected branching type')\n    return nextQuestionIndex\n}\n\nexport class SurveyManager {\n    private _posthog: PostHog\n    private _surveyInFocus: string | null\n    private _surveyTimeouts: Map<string, NodeJS.Timeout> = new Map()\n    private _widgetSelectorListeners: Map<string, { element: Element; listener: EventListener }> = new Map()\n\n    constructor(posthog: PostHog) {\n        this._posthog = posthog\n        // This is used to track the survey that is currently in focus. We only show one survey at a time.\n        this._surveyInFocus = null\n    }\n\n    private _canShowNextEventBasedSurvey = (): boolean => {\n        // with event based surveys, we need to show the next survey without reloading the page.\n        // A simple check for div elements with the class name pattern of PostHogSurvey_xyz doesn't work here\n        // because preact leaves behind the div element for any surveys responded/dismissed with a <style> node.\n        // To alleviate this, we check the last div in the dom and see if it has any elements other than a Style node.\n        // if the last PostHogSurvey_xyz div has only one style node, we can show the next survey in the queue\n        // without reloading the page.\n        const surveyPopups = document.querySelectorAll(`div[class^=PostHogSurvey]`)\n        if (surveyPopups.length > 0) {\n            return surveyPopups[surveyPopups.length - 1].shadowRoot?.childElementCount === 1\n        }\n        return true\n    }\n\n    private _clearSurveyTimeout(surveyId: string) {\n        const timeout = this._surveyTimeouts.get(surveyId)\n        if (timeout) {\n            clearTimeout(timeout)\n            this._surveyTimeouts.delete(surveyId)\n        }\n    }\n\n    private _handlePopoverSurvey = (survey: Survey): void => {\n        const surveyWaitPeriodInDays = survey.conditions?.seenSurveyWaitPeriodInDays\n        const lastSeenSurveyDate = localStorage.getItem(`lastSeenSurveyDate`)\n\n        if (!hasWaitPeriodPassed(lastSeenSurveyDate, surveyWaitPeriodInDays)) {\n            return\n        }\n\n        const surveySeen = getSurveySeen(survey)\n        if (!surveySeen) {\n            this._clearSurveyTimeout(survey.id)\n            this._addSurveyToFocus(survey.id)\n            const delaySeconds = survey.appearance?.surveyPopupDelaySeconds || 0\n            const shadow = createShadow(style(survey?.appearance), survey.id, undefined, this._posthog)\n            if (delaySeconds <= 0) {\n                return Preact.render(\n                    <SurveyPopup\n                        key={'popover-survey'}\n                        posthog={this._posthog}\n                        survey={survey}\n                        removeSurveyFromFocus={this._removeSurveyFromFocus}\n                        isPopup={true}\n                    />,\n                    shadow\n                )\n            }\n            const timeoutId = setTimeout(() => {\n                if (!doesSurveyUrlMatch(survey)) {\n                    return this._removeSurveyFromFocus(survey.id)\n                }\n                // rendering with surveyPopupDelaySeconds = 0 because we're already handling the timeout here\n                Preact.render(\n                    <SurveyPopup\n                        key={'popover-survey'}\n                        posthog={this._posthog}\n                        survey={{ ...survey, appearance: { ...survey.appearance, surveyPopupDelaySeconds: 0 } }}\n                        removeSurveyFromFocus={this._removeSurveyFromFocus}\n                        isPopup={true}\n                    />,\n                    shadow\n                )\n            }, delaySeconds * 1000)\n            this._surveyTimeouts.set(survey.id, timeoutId)\n        }\n    }\n\n    private _handleWidget = (survey: Survey): void => {\n        // Ensure widget container exists if it doesn't\n        const shadow = retrieveWidgetShadow(survey, this._posthog)\n        const stylesheetContent = style(survey.appearance)\n        const WIDGET_STYLE_ID = 'ph-data-style-id'\n\n        // Check if the stylesheet already exists\n        if (!shadow.querySelector(`style[${WIDGET_STYLE_ID}=\"${WIDGET_STYLE_ID}\"]`)) {\n            const stylesheet = prepareStylesheet(document, stylesheetContent, this._posthog)\n\n            if (stylesheet) {\n                stylesheet.setAttribute(WIDGET_STYLE_ID, WIDGET_STYLE_ID) // Add identifier\n                shadow.appendChild(stylesheet)\n            }\n        }\n\n        Preact.render(\n            <FeedbackWidget\n                key={'feedback-survey-' + survey.id} // Use unique key\n                posthog={this._posthog}\n                survey={survey}\n                removeSurveyFromFocus={this._removeSurveyFromFocus}\n            />,\n            shadow\n        )\n    }\n\n    private _removeWidgetSelectorListener = (surveyId: string): void => {\n        const existing = this._widgetSelectorListeners.get(surveyId)\n        if (existing) {\n            existing.element.removeEventListener('click', existing.listener)\n            existing.element.removeAttribute('PHWidgetSurveyClickListener')\n            this._widgetSelectorListeners.delete(surveyId)\n            logger.info(`Removed click listener for survey ${surveyId}`)\n        }\n    }\n\n    private _manageWidgetSelectorListener = (survey: Survey): void => {\n        const selector = survey.appearance?.widgetSelector\n        if (!selector) {\n            return\n        }\n\n        const currentElement = document.querySelector(selector)\n        const existingListenerData = this._widgetSelectorListeners.get(survey.id)\n\n        if (!currentElement) {\n            // Element not found, remove listener if it exists\n            if (existingListenerData) {\n                this._removeWidgetSelectorListener(survey.id)\n            }\n            return\n        }\n\n        // Ensure the base widget is rendered first if needed\n        this._handleWidget(survey)\n\n        if (existingListenerData) {\n            // Listener exists, check if element changed\n            if (currentElement !== existingListenerData.element) {\n                logger.info(`Selector element changed for survey ${survey.id}. Re-attaching listener.`)\n                this._removeWidgetSelectorListener(survey.id)\n                // Continue to attach listener to the new element below\n            } else {\n                // Element is the same, listener already attached, do nothing\n                return\n            }\n        }\n\n        // Element found, and no listener attached (or it was just removed from old element)\n        if (!currentElement.hasAttribute('PHWidgetSurveyClickListener')) {\n            const listener = (event: Event) => {\n                event.stopPropagation() // Prevent bubbling\n\n                if (survey.appearance?.position !== SurveyPosition.NextToTrigger) {\n                    window.dispatchEvent(\n                        new CustomEvent(DISPATCH_FEEDBACK_WIDGET_EVENT, {\n                            detail: { surveyId: survey.id, position: {} },\n                        })\n                    )\n                    return\n                }\n\n                const buttonRect = (event.currentTarget as HTMLElement).getBoundingClientRect()\n                const viewportHeight = window.innerHeight\n                const viewportWidth = window.innerWidth\n                const surveyWidth = parseInt(survey.appearance?.maxWidth || '300')\n                const estimatedMinSurveyHeight = 250 // Keep this estimation\n                const buttonCenterX = buttonRect.left + buttonRect.width / 2\n                let left = buttonCenterX - surveyWidth / 2\n                const horizontalPadding = 20\n                if (left + surveyWidth > viewportWidth - horizontalPadding) {\n                    left = viewportWidth - surveyWidth - horizontalPadding\n                }\n                if (left < horizontalPadding) {\n                    left = horizontalPadding\n                }\n                const spacing = 12\n                const spaceBelow = viewportHeight - buttonRect.bottom\n                const spaceAbove = buttonRect.top\n                const showAbove = spaceBelow < estimatedMinSurveyHeight && spaceAbove > spaceBelow\n\n                const positionStyles: React.CSSProperties = {\n                    position: 'fixed',\n                    top: showAbove ? 'auto' : `${buttonRect.bottom + spacing}px`,\n                    left: `${left}px`,\n                    right: 'auto',\n                    bottom: showAbove ? `${viewportHeight - buttonRect.top + spacing}px` : 'auto',\n                    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n                    borderBottom: `1.5px solid ${survey.appearance?.borderColor || '#c9c6c6'}`,\n                    borderRadius: '10px',\n                    zIndex: SURVEY_DEFAULT_Z_INDEX,\n                }\n\n                // Dispatch event for the FeedbackWidget to catch\n                window.dispatchEvent(\n                    new CustomEvent(DISPATCH_FEEDBACK_WIDGET_EVENT, {\n                        detail: { surveyId: survey.id, position: positionStyles },\n                    })\n                )\n            }\n\n            addEventListener(currentElement, 'click', listener)\n            currentElement.setAttribute('PHWidgetSurveyClickListener', 'true')\n            this._widgetSelectorListeners.set(survey.id, { element: currentElement, listener })\n            logger.info(`Attached click listener for survey ${survey.id}`)\n        }\n    }\n\n    /**\n     * Sorts surveys by their appearance delay in ascending order. If a survey does not have an appearance delay,\n     * it is considered to have a delay of 0.\n     * @param surveys\n     * @returns The surveys sorted by their appearance delay\n     */\n    private _sortSurveysByAppearanceDelay(surveys: Survey[]): Survey[] {\n        return surveys.sort((a, b) => {\n            const aIsAlways = a.schedule === SurveySchedule.Always\n            const bIsAlways = b.schedule === SurveySchedule.Always\n\n            if (aIsAlways && !bIsAlways) {\n                return 1 // a comes after b\n            }\n            if (!aIsAlways && bIsAlways) {\n                return -1 // a comes before b\n            }\n            // If both are Always or neither is Always, sort by delay\n            return (a.appearance?.surveyPopupDelaySeconds || 0) - (b.appearance?.surveyPopupDelaySeconds || 0)\n        })\n    }\n\n    public renderSurvey = (survey: Survey, selector: Element): void => {\n        Preact.render(\n            <SurveyPopup\n                key={'popover-survey'}\n                posthog={this._posthog}\n                survey={survey}\n                removeSurveyFromFocus={this._removeSurveyFromFocus}\n                isPopup={false}\n            />,\n            selector\n        )\n    }\n\n    private _isSurveyFeatureFlagEnabled(flagKey: string | null) {\n        if (!flagKey) {\n            return true\n        }\n        return !!this._posthog.featureFlags.isFeatureEnabled(flagKey)\n    }\n\n    private _isSurveyConditionMatched(survey: Survey): boolean {\n        if (!survey.conditions) {\n            return true\n        }\n        return doesSurveyUrlMatch(survey) && doesSurveyDeviceTypesMatch(survey) && doesSurveyMatchSelector(survey)\n    }\n\n    private _internalFlagCheckSatisfied(survey: Survey): boolean {\n        return canActivateRepeatedly(survey) || this._isSurveyFeatureFlagEnabled(survey.internal_targeting_flag_key)\n    }\n\n    public checkSurveyEligibility(survey: Survey): { eligible: boolean; reason?: string } {\n        const eligibility = { eligible: true, reason: undefined as string | undefined }\n\n        if (!isSurveyRunning(survey)) {\n            eligibility.eligible = false\n            eligibility.reason = `Survey is not running. It was completed on ${survey.end_date}`\n            return eligibility\n        }\n\n        if (!this._isSurveyFeatureFlagEnabled(survey.linked_flag_key)) {\n            eligibility.eligible = false\n            eligibility.reason = `Survey linked feature flag is not enabled`\n            return eligibility\n        }\n\n        if (!this._isSurveyFeatureFlagEnabled(survey.targeting_flag_key)) {\n            eligibility.eligible = false\n            eligibility.reason = `Survey targeting feature flag is not enabled`\n            return eligibility\n        }\n\n        if (!this._internalFlagCheckSatisfied(survey)) {\n            eligibility.eligible = false\n            eligibility.reason = 'Survey internal targeting flag is not enabled and survey cannot activate repeatedly'\n            return eligibility\n        }\n\n        return eligibility\n    }\n\n    /**\n     * Surveys can be activated by events or actions. This method checks if the survey has events and actions,\n     * and if so, it checks if the survey has been activated.\n     * @param survey\n     */\n    private _hasActionOrEventTriggeredSurvey(survey: Survey): boolean {\n        if (!doesSurveyActivateByEvent(survey) && !doesSurveyActivateByAction(survey)) {\n            // If survey doesn't depend on events/actions, it's considered \"triggered\" by default\n            return true\n        }\n        const surveysActivatedByEventsOrActions: string[] | undefined =\n            this._posthog.surveys._surveyEventReceiver?.getSurveys()\n        return !!surveysActivatedByEventsOrActions?.includes(survey.id)\n    }\n\n    private _checkFlags(survey: Survey): boolean {\n        if (!survey.feature_flag_keys?.length) {\n            return true\n        }\n\n        return survey.feature_flag_keys.every(({ key, value }) => {\n            if (!key || !value) {\n                return true\n            }\n            return this._posthog.featureFlags.isFeatureEnabled(value)\n        })\n    }\n\n    public getActiveMatchingSurveys = (callback: SurveyCallback, forceReload = false): void => {\n        this._posthog?.surveys.getSurveys((surveys) => {\n            const targetingMatchedSurveys = surveys.filter((survey) => {\n                const eligibility = this.checkSurveyEligibility(survey)\n                return (\n                    eligibility.eligible &&\n                    this._isSurveyConditionMatched(survey) &&\n                    this._hasActionOrEventTriggeredSurvey(survey) &&\n                    this._checkFlags(survey)\n                )\n            })\n\n            callback(targetingMatchedSurveys)\n        }, forceReload)\n    }\n\n    public callSurveysAndEvaluateDisplayLogic = (forceReload: boolean = false): void => {\n        this.getActiveMatchingSurveys((surveys) => {\n            const nonAPISurveys = surveys.filter((survey) => survey.type !== SurveyType.API)\n\n            // Create a queue of surveys sorted by their appearance delay.  We will evaluate the display logic\n            // for each survey in the queue in order, and only display one survey at a time.\n            const nonAPISurveyQueue = this._sortSurveysByAppearanceDelay(nonAPISurveys)\n\n            // Keep track of surveys processed this cycle to remove listeners for inactive ones\n            const activeSelectorSurveyIds = new Set<string>()\n\n            nonAPISurveyQueue.forEach((survey) => {\n                // Widget Type Logic\n                if (survey.type === SurveyType.Widget) {\n                    if (survey.appearance?.widgetType === SurveyWidgetType.Tab) {\n                        // Render tab widget if not already present\n                        this._handleWidget(survey)\n                    } else if (\n                        survey.appearance?.widgetType === SurveyWidgetType.Selector &&\n                        survey.appearance?.widgetSelector\n                    ) {\n                        activeSelectorSurveyIds.add(survey.id)\n                        // Manage the listener attachment/detachment dynamically\n                        this._manageWidgetSelectorListener(survey)\n                    }\n                }\n\n                // Popover Type Logic (only one shown at a time)\n                if (\n                    isNull(this._surveyInFocus) &&\n                    survey.type === SurveyType.Popover &&\n                    this._canShowNextEventBasedSurvey()\n                ) {\n                    this._handlePopoverSurvey(survey)\n                }\n            })\n\n            // Clean up listeners for surveys that are no longer active or matched\n            this._widgetSelectorListeners.forEach((_, surveyId) => {\n                if (!activeSelectorSurveyIds.has(surveyId)) {\n                    this._removeWidgetSelectorListener(surveyId)\n                }\n            })\n        }, forceReload)\n    }\n\n    private _addSurveyToFocus = (id: string): void => {\n        if (!isNull(this._surveyInFocus)) {\n            logger.error(`Survey ${[...this._surveyInFocus]} already in focus. Cannot add survey ${id}.`)\n        }\n        this._surveyInFocus = id\n    }\n\n    private _removeSurveyFromFocus = (id: string): void => {\n        if (this._surveyInFocus !== id) {\n            logger.error(`Survey ${id} is not in focus. Cannot remove survey ${id}.`)\n        }\n        this._clearSurveyTimeout(id)\n        this._surveyInFocus = null\n    }\n\n    // Expose internal state and methods for testing\n    public getTestAPI() {\n        return {\n            addSurveyToFocus: this._addSurveyToFocus,\n            removeSurveyFromFocus: this._removeSurveyFromFocus,\n            surveyInFocus: this._surveyInFocus,\n            surveyTimeouts: this._surveyTimeouts,\n            canShowNextEventBasedSurvey: this._canShowNextEventBasedSurvey,\n            handleWidget: this._handleWidget,\n            handlePopoverSurvey: this._handlePopoverSurvey,\n            manageWidgetSelectorListener: this._manageWidgetSelectorListener,\n            sortSurveysByAppearanceDelay: this._sortSurveysByAppearanceDelay,\n            checkFlags: this._checkFlags.bind(this),\n        }\n    }\n}\n\nexport const renderSurveysPreview = ({\n    survey,\n    parentElement,\n    previewPageIndex,\n    forceDisableHtml,\n    onPreviewSubmit,\n    posthog,\n}: {\n    survey: Survey\n    parentElement: HTMLElement\n    previewPageIndex: number\n    forceDisableHtml?: boolean\n    onPreviewSubmit?: (res: string | string[] | number | null) => void\n    posthog?: PostHog\n}) => {\n    const stylesheetContent = style(survey.appearance)\n    const stylesheet = prepareStylesheet(document, stylesheetContent, posthog)\n\n    // Remove previously attached <style>\n    Array.from(parentElement.children).forEach((child) => {\n        if (child instanceof HTMLStyleElement) {\n            parentElement.removeChild(child)\n        }\n    })\n\n    if (stylesheet) {\n        parentElement.appendChild(stylesheet)\n    }\n\n    const textColor = getContrastingTextColor(\n        survey.appearance?.backgroundColor || defaultSurveyAppearance.backgroundColor || 'white'\n    )\n\n    Preact.render(\n        <SurveyPopup\n            key=\"surveys-render-preview\"\n            survey={survey}\n            forceDisableHtml={forceDisableHtml}\n            style={{\n                position: 'relative',\n                right: 0,\n                borderBottom: `1px solid ${survey.appearance?.borderColor}`,\n                borderRadius: 10,\n                color: textColor,\n            }}\n            onPreviewSubmit={onPreviewSubmit}\n            previewPageIndex={previewPageIndex}\n            removeSurveyFromFocus={() => {}}\n            isPopup={true}\n        />,\n        parentElement\n    )\n}\n\nexport const renderFeedbackWidgetPreview = ({\n    survey,\n    root,\n    forceDisableHtml,\n    posthog,\n}: {\n    survey: Survey\n    root: HTMLElement\n    forceDisableHtml?: boolean\n    posthog?: PostHog\n}) => {\n    const stylesheetContent = createWidgetStyle(survey.appearance?.widgetColor)\n    const stylesheet = prepareStylesheet(document, stylesheetContent, posthog)\n    if (stylesheet) {\n        root.appendChild(stylesheet)\n    }\n\n    Preact.render(\n        <FeedbackWidget\n            key={'feedback-render-preview'}\n            forceDisableHtml={forceDisableHtml}\n            survey={survey}\n            readOnly={true}\n            removeSurveyFromFocus={() => {}}\n        />,\n        root\n    )\n}\n\n// This is the main exported function\nexport function generateSurveys(posthog: PostHog) {\n    // NOTE: Important to ensure we never try and run surveys without a window environment\n    if (!document || !window) {\n        return\n    }\n\n    const surveyManager = new SurveyManager(posthog)\n    surveyManager.callSurveysAndEvaluateDisplayLogic(true)\n\n    // recalculate surveys every second to check if URL or selectors have changed\n    setInterval(() => {\n        surveyManager.callSurveysAndEvaluateDisplayLogic(false)\n    }, 1000)\n    return surveyManager\n}\n\ntype UseHideSurveyOnURLChangeProps = {\n    survey: Pick<Survey, 'id' | 'conditions' | 'type' | 'appearance'>\n    removeSurveyFromFocus: (id: string) => void\n    setSurveyVisible: (visible: boolean) => void\n    isPreviewMode?: boolean\n}\n\n/**\n * This hook handles URL-based survey visibility after the initial mount.\n * The initial URL check is handled by the `getActiveMatchingSurveys` method in  the `PostHogSurveys` class,\n * which ensures the URL matches before displaying a survey for the first time.\n * That is the method that is called every second to see if there's a matching survey.\n *\n * This separation of concerns means:\n * 1. Initial URL matching is done by `getActiveMatchingSurveys` before displaying the survey\n * 2. Subsequent URL changes are handled here to hide the survey as the user navigates\n */\nexport function useHideSurveyOnURLChange({\n    survey,\n    removeSurveyFromFocus,\n    setSurveyVisible,\n    isPreviewMode = false,\n}: UseHideSurveyOnURLChangeProps) {\n    useEffect(() => {\n        if (isPreviewMode || !survey.conditions?.url) {\n            return\n        }\n\n        const checkUrlMatch = () => {\n            const isSurveyTypeWidget = survey.type === SurveyType.Widget\n            const doesSurveyMatchUrlCondition = doesSurveyUrlMatch(survey)\n            const isSurveyWidgetTypeTab = survey.appearance?.widgetType === SurveyWidgetType.Tab && isSurveyTypeWidget\n\n            if (doesSurveyMatchUrlCondition) {\n                if (isSurveyWidgetTypeTab) {\n                    logger.info(`Showing survey ${survey.id} because it is a feedback button tab and URL matches`)\n                    setSurveyVisible(true)\n                }\n                return\n            }\n\n            logger.info(`Hiding survey ${survey.id} because URL does not match`)\n            setSurveyVisible(false)\n            return removeSurveyFromFocus(survey.id)\n        }\n\n        // Listen for browser back/forward browser history changes\n        addEventListener(window, 'popstate', checkUrlMatch)\n        // Listen for hash changes, for SPA frameworks that use hash-based routing\n        // The hashchange event is fired when the fragment identifier of the URL has changed (the part of the URL beginning with and following the # symbol).\n        addEventListener(window, 'hashchange', checkUrlMatch)\n\n        // Listen for SPA navigation\n        const originalPushState = window.history.pushState\n        const originalReplaceState = window.history.replaceState\n\n        window.history.pushState = function (...args) {\n            originalPushState.apply(this, args)\n            checkUrlMatch()\n        }\n\n        window.history.replaceState = function (...args) {\n            originalReplaceState.apply(this, args)\n            checkUrlMatch()\n        }\n\n        return () => {\n            window.removeEventListener('popstate', checkUrlMatch)\n            window.removeEventListener('hashchange', checkUrlMatch)\n            window.history.pushState = originalPushState\n            window.history.replaceState = originalReplaceState\n        }\n    }, [isPreviewMode, survey, removeSurveyFromFocus, setSurveyVisible])\n}\n\nexport function usePopupVisibility(\n    survey: Survey,\n    posthog: PostHog | undefined,\n    millisecondDelay: number,\n    isPreviewMode: boolean,\n    removeSurveyFromFocus: (id: string) => void\n) {\n    const [isPopupVisible, setIsPopupVisible] = useState(isPreviewMode || millisecondDelay === 0)\n    const [isSurveySent, setIsSurveySent] = useState(false)\n\n    useEffect(() => {\n        if (!posthog) {\n            logger.error('usePopupVisibility hook called without a PostHog instance.')\n            return\n        }\n        if (isPreviewMode) {\n            return\n        }\n\n        const handleSurveyClosed = (event: CustomEvent) => {\n            if (event.detail.surveyId !== survey.id) {\n                return\n            }\n            removeSurveyFromFocus(survey.id)\n            setIsPopupVisible(false)\n        }\n\n        const handleSurveySent = (event: CustomEvent) => {\n            if (event.detail.surveyId !== survey.id) {\n                return\n            }\n            if (!survey.appearance?.displayThankYouMessage) {\n                removeSurveyFromFocus(survey.id)\n                setIsPopupVisible(false)\n            } else {\n                setIsSurveySent(true)\n                removeSurveyFromFocus(survey.id)\n                if (survey.appearance?.autoDisappear) {\n                    setTimeout(() => {\n                        setIsPopupVisible(false)\n                    }, 5000)\n                }\n            }\n        }\n\n        const showSurvey = () => {\n            // check if the url is still matching, necessary for delayed surveys, as the URL may have changed\n            if (!doesSurveyUrlMatch(survey)) {\n                return\n            }\n\n            setIsPopupVisible(true)\n            window.dispatchEvent(new Event('PHSurveyShown'))\n            posthog.capture('survey shown', {\n                $survey_name: survey.name,\n                $survey_id: survey.id,\n                $survey_iteration: survey.current_iteration,\n                $survey_iteration_start_date: survey.current_iteration_start_date,\n                sessionRecordingUrl: posthog.get_session_replay_url?.(),\n            })\n            localStorage.setItem('lastSeenSurveyDate', new Date().toISOString())\n            setTimeout(() => {\n                const inputField = document\n                    .querySelector(getSurveyContainerClass(survey, true))\n                    ?.shadowRoot?.querySelector('textarea, input[type=\"text\"]') as HTMLElement\n                if (inputField) {\n                    inputField.focus()\n                }\n            }, 100)\n        }\n\n        addEventListener(window, 'PHSurveyClosed', handleSurveyClosed as EventListener)\n        addEventListener(window, 'PHSurveySent', handleSurveySent as EventListener)\n\n        if (millisecondDelay > 0) {\n            // This path is only used for direct usage of SurveyPopup,\n            // not for surveys managed by SurveyManager\n            const timeoutId = setTimeout(showSurvey, millisecondDelay)\n            return () => {\n                clearTimeout(timeoutId)\n                window.removeEventListener('PHSurveyClosed', handleSurveyClosed as EventListener)\n                window.removeEventListener('PHSurveySent', handleSurveySent as EventListener)\n            }\n        } else {\n            // This is the path used for surveys managed by SurveyManager\n            showSurvey()\n            return () => {\n                window.removeEventListener('PHSurveyClosed', handleSurveyClosed as EventListener)\n                window.removeEventListener('PHSurveySent', handleSurveySent as EventListener)\n            }\n        }\n    }, [])\n\n    useHideSurveyOnURLChange({\n        survey,\n        removeSurveyFromFocus,\n        setSurveyVisible: setIsPopupVisible,\n        isPreviewMode,\n    })\n\n    return { isPopupVisible, isSurveySent, setIsPopupVisible }\n}\n\ninterface SurveyPopupProps {\n    survey: Survey\n    forceDisableHtml?: boolean\n    posthog?: PostHog\n    style?: React.CSSProperties\n    previewPageIndex?: number | undefined\n    removeSurveyFromFocus: (id: string) => void\n    isPopup?: boolean\n    onPreviewSubmit?: (res: string | string[] | number | null) => void\n    onPopupSurveyDismissed?: () => void\n    onCloseConfirmationMessage?: () => void\n}\n\nexport function SurveyPopup({\n    survey,\n    forceDisableHtml,\n    posthog,\n    style,\n    previewPageIndex,\n    removeSurveyFromFocus,\n    isPopup,\n    onPreviewSubmit = () => {},\n    onPopupSurveyDismissed = () => {},\n    onCloseConfirmationMessage = () => {},\n}: SurveyPopupProps) {\n    const isPreviewMode = Number.isInteger(previewPageIndex)\n    // NB: The client-side code passes the millisecondDelay in seconds, but setTimeout expects milliseconds, so we multiply by 1000\n    const surveyPopupDelayMilliseconds = survey.appearance?.surveyPopupDelaySeconds\n        ? survey.appearance.surveyPopupDelaySeconds * 1000\n        : 0\n    const { isPopupVisible, isSurveySent, setIsPopupVisible } = usePopupVisibility(\n        survey,\n        posthog,\n        surveyPopupDelayMilliseconds,\n        isPreviewMode,\n        removeSurveyFromFocus\n    )\n    const shouldShowConfirmation = isSurveySent || previewPageIndex === survey.questions.length\n    const confirmationBoxLeftStyle = style?.left && isNumber(style?.left) ? { left: style.left - 40 } : {}\n\n    if (isPreviewMode) {\n        style = style || {}\n        style.left = 'unset'\n        style.right = 'unset'\n        style.transform = 'unset'\n    }\n\n    return isPopupVisible ? (\n        <SurveyContext.Provider\n            value={{\n                isPreviewMode,\n                previewPageIndex: previewPageIndex,\n                onPopupSurveyDismissed: () => {\n                    dismissedSurveyEvent(survey, posthog, isPreviewMode)\n                    onPopupSurveyDismissed()\n                },\n                isPopup: isPopup || false,\n                onPreviewSubmit,\n            }}\n        >\n            {!shouldShowConfirmation ? (\n                <Questions\n                    survey={survey}\n                    forceDisableHtml={!!forceDisableHtml}\n                    posthog={posthog}\n                    styleOverrides={style}\n                />\n            ) : (\n                <ConfirmationMessage\n                    header={survey.appearance?.thankYouMessageHeader || 'Thank you!'}\n                    description={survey.appearance?.thankYouMessageDescription || ''}\n                    forceDisableHtml={!!forceDisableHtml}\n                    contentType={survey.appearance?.thankYouMessageDescriptionContentType}\n                    appearance={survey.appearance || defaultSurveyAppearance}\n                    styleOverrides={{ ...style, ...confirmationBoxLeftStyle }}\n                    onClose={() => {\n                        setIsPopupVisible(false)\n                        onCloseConfirmationMessage()\n                    }}\n                />\n            )}\n        </SurveyContext.Provider>\n    ) : null\n}\n\nexport function Questions({\n    survey,\n    forceDisableHtml,\n    posthog,\n    styleOverrides,\n}: {\n    survey: Survey\n    forceDisableHtml: boolean\n    posthog?: PostHog\n    styleOverrides?: React.CSSProperties\n}) {\n    const textColor = getContrastingTextColor(\n        survey.appearance?.backgroundColor || defaultSurveyAppearance.backgroundColor\n    )\n    const [questionsResponses, setQuestionsResponses] = useState({})\n    const { previewPageIndex, onPopupSurveyDismissed, isPopup, onPreviewSubmit } = useContext(SurveyContext)\n    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(previewPageIndex || 0)\n    const surveyQuestions = useMemo(() => getDisplayOrderQuestions(survey), [survey])\n\n    // Sync preview state\n    useEffect(() => {\n        setCurrentQuestionIndex(previewPageIndex ?? 0)\n    }, [previewPageIndex])\n\n    const onNextButtonClick = ({\n        res,\n        displayQuestionIndex,\n        questionId,\n    }: {\n        res: string | string[] | number | null\n        displayQuestionIndex: number\n        questionId?: string\n    }) => {\n        if (!posthog) {\n            logger.error('onNextButtonClick called without a PostHog instance.')\n            return\n        }\n\n        if (!questionId) {\n            logger.error('onNextButtonClick called without a questionId.')\n            return\n        }\n\n        const responseKey = getSurveyResponseKey(questionId)\n\n        setQuestionsResponses({ ...questionsResponses, [responseKey]: res })\n\n        const nextStep = getNextSurveyStep(survey, displayQuestionIndex, res)\n        if (nextStep === SurveyQuestionBranchingType.End) {\n            sendSurveyEvent({ ...questionsResponses, [responseKey]: res }, survey, posthog)\n        } else {\n            setCurrentQuestionIndex(nextStep)\n        }\n    }\n\n    return (\n        <form\n            className=\"survey-form\"\n            name=\"surveyForm\"\n            style={\n                isPopup\n                    ? {\n                          color: textColor,\n                          borderColor: survey.appearance?.borderColor,\n                          ...styleOverrides,\n                      }\n                    : {}\n            }\n        >\n            {surveyQuestions.map((question, displayQuestionIndex) => {\n                const isVisible = currentQuestionIndex === displayQuestionIndex\n                return (\n                    isVisible && (\n                        <div\n                            className=\"survey-box\"\n                            style={\n                                isPopup\n                                    ? {\n                                          backgroundColor:\n                                              survey.appearance?.backgroundColor ||\n                                              defaultSurveyAppearance.backgroundColor,\n                                      }\n                                    : {}\n                            }\n                        >\n                            {isPopup && (\n                                <Cancel\n                                    onClick={() => {\n                                        onPopupSurveyDismissed()\n                                    }}\n                                />\n                            )}\n                            {getQuestionComponent({\n                                question,\n                                forceDisableHtml,\n                                displayQuestionIndex,\n                                appearance: survey.appearance || defaultSurveyAppearance,\n                                onSubmit: (res) =>\n                                    onNextButtonClick({\n                                        res,\n                                        displayQuestionIndex,\n                                        questionId: question.id,\n                                    }),\n                                onPreviewSubmit,\n                            })}\n                        </div>\n                    )\n                )\n            })}\n        </form>\n    )\n}\n\nexport function FeedbackWidget({\n    survey,\n    forceDisableHtml,\n    posthog,\n    readOnly,\n    removeSurveyFromFocus,\n}: {\n    survey: Survey\n    forceDisableHtml?: boolean\n    posthog?: PostHog\n    readOnly?: boolean\n    removeSurveyFromFocus: (id: string) => void\n}): JSX.Element | null {\n    const [isFeedbackButtonVisible, setIsFeedbackButtonVisible] = useState(true)\n    const [showSurvey, setShowSurvey] = useState(false)\n    const [styleOverrides, setStyleOverrides] = useState<React.CSSProperties>({})\n\n    useEffect(() => {\n        if (!posthog) {\n            logger.error('FeedbackWidget called without a PostHog instance.')\n            return\n        }\n        if (readOnly) {\n            return\n        }\n\n        if (survey.appearance?.widgetType === 'tab') {\n            setStyleOverrides({\n                top: '50%',\n                bottom: 'auto',\n                borderRadius: 10,\n                borderBottom: `1.5px solid ${survey.appearance?.borderColor || '#c9c6c6'}`,\n            })\n        }\n        const handleShowSurvey = (event: Event) => {\n            const customEvent = event as CustomEvent\n            // Check if the event is for this specific survey instance\n            if (customEvent.detail?.surveyId === survey.id) {\n                logger.info(`Received show event for survey ${survey.id}`)\n                setStyleOverrides(customEvent.detail.position || {})\n                setShowSurvey(true) // Show the survey popup\n            }\n        }\n\n        addEventListener(window, DISPATCH_FEEDBACK_WIDGET_EVENT, handleShowSurvey)\n\n        // Cleanup listener on component unmount\n        return () => {\n            window.removeEventListener(DISPATCH_FEEDBACK_WIDGET_EVENT, handleShowSurvey)\n        }\n    }, [\n        posthog,\n        readOnly,\n        survey.id,\n        survey.appearance?.widgetType,\n        survey.appearance?.widgetSelector,\n        survey.appearance?.borderColor,\n    ])\n\n    useHideSurveyOnURLChange({\n        survey,\n        removeSurveyFromFocus,\n        setSurveyVisible: setIsFeedbackButtonVisible,\n    })\n\n    if (!isFeedbackButtonVisible) {\n        return null\n    }\n\n    const resetShowSurvey = () => {\n        setShowSurvey(false)\n    }\n\n    return (\n        <Preact.Fragment>\n            {survey.appearance?.widgetType === 'tab' && (\n                <div\n                    className=\"ph-survey-widget-tab\"\n                    onClick={() => !readOnly && setShowSurvey(!showSurvey)}\n                    style={{ color: getContrastingTextColor(survey.appearance.widgetColor) }}\n                >\n                    <div className=\"ph-survey-widget-tab-icon\"></div>\n                    {survey.appearance?.widgetLabel || ''}\n                </div>\n            )}\n            {showSurvey && (\n                <SurveyPopup\n                    key={'feedback-widget-survey'}\n                    posthog={posthog}\n                    survey={survey}\n                    forceDisableHtml={forceDisableHtml}\n                    style={styleOverrides}\n                    removeSurveyFromFocus={removeSurveyFromFocus}\n                    isPopup={true}\n                    onPopupSurveyDismissed={resetShowSurvey}\n                    onCloseConfirmationMessage={resetShowSurvey}\n                />\n            )}\n        </Preact.Fragment>\n    )\n}\n\ninterface GetQuestionComponentProps {\n    question: SurveyQuestion\n    forceDisableHtml: boolean\n    displayQuestionIndex: number\n    appearance: SurveyAppearance\n    onSubmit: (res: string | string[] | number | null) => void\n    onPreviewSubmit: (res: string | string[] | number | null) => void\n}\n\nconst getQuestionComponent = ({\n    question,\n    forceDisableHtml,\n    displayQuestionIndex,\n    appearance,\n    onSubmit,\n    onPreviewSubmit,\n}: GetQuestionComponentProps): JSX.Element => {\n    const questionComponents = {\n        [SurveyQuestionType.Open]: OpenTextQuestion,\n        [SurveyQuestionType.Link]: LinkQuestion,\n        [SurveyQuestionType.Rating]: RatingQuestion,\n        [SurveyQuestionType.SingleChoice]: MultipleChoiceQuestion,\n        [SurveyQuestionType.MultipleChoice]: MultipleChoiceQuestion,\n    }\n\n    const commonProps = {\n        question,\n        forceDisableHtml,\n        appearance,\n        onPreviewSubmit: (res: string | string[] | number | null) => {\n            onPreviewSubmit(res)\n        },\n        onSubmit: (res: string | string[] | number | null) => {\n            onSubmit(res)\n        },\n    }\n\n    const additionalProps: Record<SurveyQuestionType, any> = {\n        [SurveyQuestionType.Open]: {},\n        [SurveyQuestionType.Link]: {},\n        [SurveyQuestionType.Rating]: { displayQuestionIndex },\n        [SurveyQuestionType.SingleChoice]: { displayQuestionIndex },\n        [SurveyQuestionType.MultipleChoice]: { displayQuestionIndex },\n    }\n\n    const Component = questionComponents[question.type]\n    const componentProps = { ...commonProps, ...additionalProps[question.type] }\n\n    return <Component {...componentProps} />\n}\n"]}